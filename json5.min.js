(()=>{let n=t=>/[0-9]/.test(t),h=t=>/[0-9a-fA-F]/.test(t);let r=t=>/([a-zA-Z0-9_\$&\*\+!\?-]|[^\u0000-\u007F])/.test(t);class o{static EOF="EOF";static NAME="NAME";static KEYWORD="KEYWORD";static NUMBER="NUMBER";static STRING="STRING";static LSQB="LSQB";static RSQB="RSQB";static COLON="COLON";static COMMA="COMMA";static LBRACE="LBRACE";static RBRACE="RBRACE";static DOUBLESLASH="DOUBLESLASH";static SLASHSTAR="SLASHSTAR";static STARSLASH="STARSLASH";static HASHTAG="HASHTAG"}OP_DICT={"[":o.LSQB,"]":o.RSQB,"{":o.LBRACE,"}":o.RBRACE,",":o.COMMA,":":o.COLON},ESCAPE_CHAR={'"':'"',"/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},KEYWORDS={true:!0,false:!1,null:null,True:!0,False:!1,None:null};class e{constructor(t,e,s,i){this.index=t,this.line=e,this.column=s,this.code=i}advance(t){this.index+=1,this.column+=1,"\n"===t&&(this.column=0,this.line+=1)}copy(){return new e(this.index,this.line,this.column,this.code)}}class c extends Error{constructor(t,e,s,i,a){super(t),this.pos_start=e,s=s||e.copy(),this.pos_end=s,this.error_pos_start=i,this.error_pos_end=a,this.name="SyntaxError"}toString(){return`Line ${this.pos_end.line+1} Column ${this.pos_end.column}
``\n  SyntaxError: ${this.message}`}}class p{constructor(t,e,s,i){this.type=t,this.value=e,this.pos_start=s,void 0===i&&(i=s.copy()),this.pos_end=i}matches(t,e){var s;if(this.type==t)for(s of e=null!=(t=e)&&"function"==typeof t[Symbol.iterator]?e:[e])if(this.value==s)return!0;return!1}}class i{constructor(t){this.code=t,this.char=void 0,this.pos=new e(-1,0,-1,t),this.advance()}advance(t){for(t=t||1;0<t;)this.pos.advance(this.char),t--;this.update()}update(){this.char=this.code[this.pos.index]}lookahead(t){t=this.pos.index+(t=t||1);return this.code[t]}parse(){let t;var e,s=[];let i;for(;this.char;)if("#"===this.char)this.skip_inline_comment();else if(" "===this.char||"\n"===this.char)this.advance();else if("/"===this.char)if("/"===this.lookahead(1))this.advance(),this.skip_inline_comment();else{if("*"!==this.lookahead(1))throw t=this.pos.copy(),this.advance(),new c("expected '/' or '*'",t,this.pos.copy());this.advance(2),this.ship_block_comment()}else{if("-"===this.char||n(this.char)||"."===this.char&&n(this.lookahead(1)))i=this.make_number();else if(this.char in OP_DICT)i=this.make_opertor();else if(/['"`]/.test(this.char))i=this.make_string(this.char);else{if(!/([a-zA-Z_\$&\*\+!\?-]|[^\u0000-\u007F])/.test(this.char))throw t=this.pos.copy(),e=this.char,this.advance(),new c(`invalid character '${e}' (U+${this.char.charCodeAt().toString(16).padStart(4,"0")})`,t,this.pos.copy());i=this.make_name()}s.push(i)}return s.push(new p(o.EOF,null,this.pos.copy(),this.pos.copy())),s}skip_inline_comment(){for(this.advance();this.char&&"\n"!==this.char;)this.advance()}ship_block_comment(){for(var t=this.pos.copy();this.char&&("*"!==this.char||"/"!==this.lookahead(1));)this.advance();if("*"!==this.char||"/"!==this.lookahead(1))throw new c("expected '*/'",t,this.pos.copy())}make_number(){var t=this.pos.copy();let e;return e="0"==this.char&&"x"==this.lookahead()?(this.advance(2),this.make_num(16)):this.make_num(10),new p(o.NUMBER,e,t,this.pos.copy())}make_num(t=10){var e={10:["decimal",n],16:["hexadecimal",h]};let s=[];var i=this.pos.copy();let a=!1;for(;this.char&&r(this.char)||"_"==this.char||"."===this.char||"-"===this.char;){if("."==this.char){if(10!=t)throw this.advance(),new c(`invalid ${e[t][0]} literal`,i,this.pos.copy());a=!0}else{if("_"==this.char){this.advance();continue}if(!e[t][1](this.char)&&"-"!==this.char)throw this.advance(),new c(`invalid ${e[t][0]} literal`,i,this.pos.copy())}s.push(this.char),this.advance()}if(0==(s=s.join("")).length)throw this.advance(),new c(`invalid ${e[t][0]} literal`,i,this.pos.copy());return a?parseFloat(s):parseInt(s,t)}make_opertor(){var t=this.pos.copy(),e=OP_DICT[this.char];return this.advance(),new p(e,null,t,this.pos.copy())}make_string(t){var e=[],s=this.pos.copy();let i=!1;for(this.advance();this.char&&(this.char!=t||i);){if(!this.char||"\n"==this.char)throw new c(`unterminated string literal (expected ${"'"===t?`"'"`:`'${t}'`})`,s,this.pos.copy());if(i)if(i=!1,"u"!==this.char)e.push(ESCAPE_CHAR[this.char]||this.char),this.advance();else{var a=this.pos.copy(),n=(this.advance(),[]);for(let t=0;t<4;t++){if(!"0123456789abcdefABCDEF".includes(this.char))throw new c("Invalid Unicode escape sequence",a,this.pos.copy());n.push(this.char),this.advance()}e.push(String.fromCharCode(parseInt(n.join(""),16)))}else"\\"==this.char?i=!0:e.push(this.char),this.advance()}if(this.char!==t)throw new c(`unterminated string literal (expected ${"'"===t?`"'"`:`'${t}'`})`,s,this.pos.copy());return this.advance(),new p(o.STRING,e.join(""),s,this.pos.copy())}make_name(){let t=[];var e=this.pos.copy();for(t.push(this.char),this.advance();this.char&&r(this.char);)t.push(this.char),this.advance();return(t=t.join(""))in KEYWORDS?new p(o.KEYWORD,KEYWORDS[t],e,this.pos.copy()):new p(o.NAME,t,e,this.pos.copy())}}class t{type;pos_start;pos_end;parse(){throw new Error("未实现的抽象方法")}}class s extends t{type="single";constructor(t){super(),this.value=t,this.pos_start=t.pos_start?t.pos_start.copy():null,this.pos_end=t.pos_end?t.pos_end.copy():null}parse(){return this.value.value+""}}class a extends s{type="null"}class l extends s{type="boolean"}class u extends s{type="number"}class d extends s{type="string";parse(){var t;return t=this.value.value,"[object String]"===Object.prototype.toString.call(t)?JSON.stringify(this.value.value):'"'+this.value.value+'"'}}class v extends t{type="warning";constructor(t){super(),this.value=t}parse(){return""}}class y extends t{type="error";constructor(t){super(),this.value=t}parse(){return""}}class _ extends t{type="list";constructor(t,e,s){super(),this.items=t,this.pos_start=this.pos_start,this.pos_end=s}parse(t){var e,s,i=[];for(e of this.items)e instanceof v||e instanceof y||i.push(e.parse(t));return 0===i.length?"[]":null!=t?(s="\n"+" ".repeat(t),"["+("\n"+i.join(",\n")).split("\n").join(s)+"\n]"):`[${i.join(",")}]`}}class w extends t{type="dict";constructor(t,e,s){super(),this.items=t,this.pos_start=this.pos_start,this.pos_end=s}parse(t){var e,s,i,a=[],n=null!=t?" ":"";for([e,s]of this.items)e instanceof v||e instanceof y||s instanceof v||s instanceof y||a.push(e.parse(t)+":"+n+s.parse(t));return 0===a.length?"{}":null!=t?(i="\n"+" ".repeat(t),"{"+("\n"+a.join(",\n")).split("\n").join(i)+"\n}"):`{${a.join(",")}}`}}class f{constructor(t){this.tokens=t,this.index=-1,this.token=void 0,this.advance()}advance(t){this.index+=t=t||1,this.update()}update(){this.token=this.tokens[this.index]}lookahead(t){return this.tokens[this.index+(t=t||1)]}parse(){return this.json()}json(){var t,e;return this.token.type===o.EOF?[]:(t=this.atom(),this.token.type!==o.EOF?(e=new c("the statement must not exist",this.token.pos_start,this.token.pos_end),[t,new v(new p(o.STRING,e.toString(),null,null))]):t)}atom(){var t=this.token;switch(t.type){case o.KEYWORD:case o.NUMBER:case o.STRING:case o.NAME:return this.advance(),t.type===o.KEYWORD?new(!0===t.value||!1===t.value?l:a)(t):new(t.type===o.NUMBER?u:d)(t);case o.LSQB:return this.list_expr();case o.LBRACE:return this.dict_expr();default:throw new c("invalid atom",t.pos_start.copy(),t.pos_end.copy())}}list_expr(){var t,e=this.token.pos_start.copy();return this.advance(),this.token.type===o.RSQB?(this.advance(),new _([],e,this.token.pos_end.copy())):(t=this.atoms(),this.token.type!=o.RSQB?t.push(new v(new p(o.STRING,'expected "]"',null,null))):this.advance(),new _(t,e,this.token.pos_end.copy()))}atoms(){this.token.pos_start.copy();let t;try{t=[this.atom()]}catch(t){return[]}for(;this.token.type===o.COMMA&&(this.advance(),this.token.type!==o.RSQB);)try{t.push(this.atom())}catch(t){}return t}dict_expr(){var t,e=this.token.pos_start.copy();return this.advance(),this.token.type===o.RBRACE?(this.advance(),new w([],e,this.token.pos_end.copy())):(t=this.kvpairs(),this.token.type!==o.RBRACE?t.push([new d(new p(o.STRING,"",null,null)),new v(new p(o.STRING,'expected "}"',null,null))]):this.advance(),new w(t,e,this.token.pos_end.copy()))}kvpairs(){for(var t=[this.kvpair()];this.token.type==o.COMMA&&(this.advance(),this.token.type!=o.RBRACE);)t.push(this.kvpair());return t}kvpair(){let e;try{e=this.key()}catch(t){return[new y(new p(o.STRING,"expected a key",null,null)),new d(new p(o.STRING,"",null,null))]}if(this.token.type!==o.COLON)return[e,new y(new p(o.STRING,'expected ":"',null,null))];if(this.advance(),this.token.type===o.COMMA||this.token.type===o.RSQB||this.token.type===o.RBRACE)return[e,new y(new p(o.STRING,"expected a value",null,null))];try{return[e,this.value()]}catch(t){return[e,new y(new p(o.STRING,"expected a value",null,null))]}}key(){var t=this.token;switch(t.type){case o.KEYWORD:case o.NUMBER:case o.STRING:case o.NAME:return this.advance(),new d(t);default:throw new c("invalid key",t.pos_start.copy(),t.pos_end.copy())}}value(){var t=this.token;switch(t.type){case o.KEYWORD:case o.NUMBER:case o.STRING:return this.advance(),t.type===o.KEYWORD?new(!0===t.value||!1===t.value?l:a)(t):new(t.type===o.NUMBER?u:d)(t);case o.LSQB:return this.list_expr();case o.LBRACE:return this.dict_expr();default:throw new c("invalid value",t.pos_start.copy(),t.pos_end.copy())}}}class R{static parse(t){t=new i(t);try{var e=t.parse(),s=new f(e).parse();return JSON.parse(s.parse())}catch(t){if(t instanceof c)return t.toString();throw t}}}"object"==typeof exports&&"object"==typeof module?module.exports=R:"function"==typeof define&&define.amd?define("JSON5",[],R):"object"==typeof exports?exports.JSON5=R:window.JSON5=R})();